"use strict";var S=Object.create;var g=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var P=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var A=(e,o)=>{for(var s in o)g(e,s,{get:o[s],enumerable:!0})},f=(e,o,s,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of I(o))!$.call(e,t)&&t!==s&&g(e,t,{get:()=>o[t],enumerable:!(r=E(o,t))||r.enumerable});return e};var x=(e,o,s)=>(s=e!=null?S(P(e)):{},f(o||!e||!e.__esModule?g(s,"default",{value:e,enumerable:!0}):s,e)),M=e=>f(g({},"__esModule",{value:!0}),e);var K={};A(K,{activate:()=>O,deactivate:()=>F});module.exports=M(K);var n=x(require("vscode")),m=x(require("path")),k=require("child_process"),y=require("util"),h=(0,y.promisify)(k.exec),R="repomixHelper.lists",B,d,p;function C(e){return Array.from(new Set(e)).sort()}function T(e){let o=n.workspace.getWorkspaceFolder(e);return o?m.relative(o.uri.fsPath,e.fsPath).split(m.sep).join("/"):null}async function w(e){return e.workspaceState.get(R)??{include:[],ignore:[]}}async function L(e,o){await e.workspaceState.update(R,{include:C(o.include),ignore:C(o.ignore)})}async function v(e){if(!d||!p)return;let o=await w(e),s=o.include.length,r=o.ignore.length;d.text=`$(package) Repomix Run  I:${s}  X:${r}`,d.tooltip="\u8FD0\u884C repomix\uFF08\u4F7F\u7528\u5F53\u524D include/ignore \u5217\u8868\uFF09",d.show(),p.text="$(trash) Repomix Clear",p.tooltip="\u6E05\u7A7A include/ignore \u5217\u8868",p.show()}async function H(e,o,s,r){let t=r&&r.length>0?r:s?[s]:[];if(t.length===0){let i=n.window.activeTextEditor;if(!i){n.window.showWarningMessage("No file selected.");return}t.push(i.document.uri)}let a=await w(e),c=0,l=0;for(let i of t){let u=T(i);if(!u){l++;continue}a[o].includes(u)||(a[o].push(u),c++)}await L(e,a),await v(e),n.window.setStatusBarMessage(`Repomix Helper: ${o} +${c}\uFF08\u8DF3\u8FC7 ${l}\uFF09`,2500)}async function U(e){await L(e,{include:[],ignore:[]}),await v(e),n.window.showInformationMessage("Repomix Helper: \u5DF2\u6E05\u7A7A include/ignore \u5217\u8868\u3002")}async function W(e){let o=await w(e);if(o.include.length===0){n.window.showWarningMessage("Repomix Helper: include \u5217\u8868\u4E3A\u7A7A\u3002");return}let r=n.workspace.getConfiguration("repomixHelper").get("repomixCommand")||"repomix",a=["--include",o.include.join(",")];if(o.ignore.length>0){let u=o.ignore.join(",");a.push("--ignore",u)}let c=n.workspace.workspaceFolders?.[0];if(!c){n.window.showWarningMessage("No workspace folder opened.");return}let l=new n.ShellExecution(r,a,{cwd:c.uri.fsPath}),i=new n.Task({type:"repomix-helper"},c,"Repomix: Pack","Repomix Helper",l);i.presentationOptions={reveal:n.TaskRevealKind.Always,panel:n.TaskPanelKind.Shared,clear:!0},n.tasks.executeTask(i)}async function b(e){let o=await w(e),r=n.workspace.getConfiguration("repomixHelper").get("repomixCommand")||"repomix",t=o.include.join(","),a=o.ignore.join(","),c=[r];t&&c.push(`--include "${t}"`),a&&c.push(`--ignore "${a}"`);let l=c.join(" "),i=n.window.createOutputChannel("Repomix Helper");i.show(!0),i.appendLine("=== Repomix Export ==="),i.appendLine(l),i.appendLine(""),i.appendLine(`Include: ${o.include.length}, Ignore: ${o.ignore.length}`),i.appendLine("======================"),t?n.window.showInformationMessage("Repomix Helper: \u5DF2\u5BFC\u51FA\u547D\u4EE4\u5230 Output\uFF08Repomix Helper\uFF09\u3002"):n.window.showWarningMessage("Repomix Helper: include \u5217\u8868\u4E3A\u7A7A\uFF0C\u5BFC\u51FA\u7684\u547D\u4EE4\u53EF\u80FD\u65E0\u6CD5\u6253\u5305\u4F60\u671F\u671B\u7684\u5185\u5BB9\u3002")}async function j(){let e=n.window.activeTextEditor;if(!e)return;let o=e.document.uri.fsPath;try{let s=o;if(process.platform==="linux"&&o.startsWith("/")){let{stdout:a}=await h(`wslpath -w "${o}"`);s=a.trim()}let t=`powershell.exe -NoProfile -Command "Set-Clipboard -LiteralPath '${s.replace(/\\/g,"\\\\")}'"`;await h(t),n.window.showInformationMessage(`\u2705 \u5DF2\u6210\u529F\u590D\u5236\u5B9E\u4F53\u6587\u4EF6: ${m.basename(o)}`)}catch(s){console.error(s),n.window.showErrorMessage("\u590D\u5236\u5931\u8D25: "+s.message)}}async function O(e){d=n.window.createStatusBarItem(n.StatusBarAlignment.Left,100),d.command="repomixHelper.run",p=n.window.createStatusBarItem(n.StatusBarAlignment.Left,99),p.command="repomixHelper.clear",e.subscriptions.push(d,p),e.subscriptions.push(n.commands.registerCommand("repomixHelper.addInclude",(o,s)=>H(e,"include",o,s)),n.commands.registerCommand("repomixHelper.addIgnore",(o,s)=>H(e,"ignore",o,s)),n.commands.registerCommand("repomixHelper.run",()=>W(e)),n.commands.registerCommand("repomixHelper.clear",()=>U(e)),n.commands.registerCommand("repomixHelper.export",()=>b(e)),n.commands.registerCommand("repomixHelper.copyFileToClipboard",()=>j())),await v(e)}function F(){B?.dispose(),d?.dispose(),p?.dispose()}0&&(module.exports={activate,deactivate});
