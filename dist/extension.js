"use strict";var R=Object.create;var m=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var E=(e,o)=>{for(var s in o)m(e,s,{get:o[s],enumerable:!0})},x=(e,o,s,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of S(o))!y.call(e,t)&&t!==s&&m(e,t,{get:()=>o[t],enumerable:!(r=L(o,t))||r.enumerable});return e};var f=(e,o,s)=>(s=e!=null?R(I(e)):{},x(o||!e||!e.__esModule?m(s,"default",{value:e,enumerable:!0}):s,e)),$=e=>x(m({},"__esModule",{value:!0}),e);var W={};E(W,{activate:()=>j,deactivate:()=>O});module.exports=$(W);var n=f(require("vscode")),g=f(require("path")),k="repomixHelper.lists",A,d,p;function h(e){return Array.from(new Set(e)).sort()}function B(e){let o=n.workspace.getWorkspaceFolder(e);return o?g.relative(o.uri.fsPath,e.fsPath).split(g.sep).join("/"):null}async function v(e){return e.workspaceState.get(k)??{include:[],ignore:[]}}async function H(e,o){await e.workspaceState.update(k,{include:h(o.include),ignore:h(o.ignore)})}async function w(e){if(!d||!p)return;let o=await v(e),s=o.include.length,r=o.ignore.length;d.text=`$(package) Repomix Run  I:${s}  X:${r}`,d.tooltip="\u8FD0\u884C repomix\uFF08\u4F7F\u7528\u5F53\u524D include/ignore \u5217\u8868\uFF09",d.show(),p.text="$(trash) Repomix Clear",p.tooltip="\u6E05\u7A7A include/ignore \u5217\u8868",p.show()}async function C(e,o,s,r){let t=r&&r.length>0?r:s?[s]:[];if(t.length===0){let i=n.window.activeTextEditor;if(!i){n.window.showWarningMessage("No file selected.");return}t.push(i.document.uri)}let a=await v(e),c=0,l=0;for(let i of t){let u=B(i);if(!u){l++;continue}a[o].includes(u)||(a[o].push(u),c++)}await H(e,a),await w(e),n.window.setStatusBarMessage(`Repomix Helper: ${o} +${c}\uFF08\u8DF3\u8FC7 ${l}\uFF09`,2500)}async function U(e){await H(e,{include:[],ignore:[]}),await w(e),n.window.showInformationMessage("Repomix Helper: \u5DF2\u6E05\u7A7A include/ignore \u5217\u8868\u3002")}async function M(e){let o=await v(e);if(o.include.length===0){n.window.showWarningMessage("Repomix Helper: include \u5217\u8868\u4E3A\u7A7A\u3002");return}let r=n.workspace.getConfiguration("repomixHelper").get("repomixCommand")||"repomix",a=["--include",o.include.join(",")];if(o.ignore.length>0){let u=o.ignore.join(",");a.push("--ignore",u)}let c=n.workspace.workspaceFolders?.[0];if(!c){n.window.showWarningMessage("No workspace folder opened.");return}let l=new n.ShellExecution(r,a,{cwd:c.uri.fsPath}),i=new n.Task({type:"repomix-helper"},c,"Repomix: Pack","Repomix Helper",l);i.presentationOptions={reveal:n.TaskRevealKind.Always,panel:n.TaskPanelKind.Shared,clear:!0},n.tasks.executeTask(i)}async function P(e){let o=await v(e),r=n.workspace.getConfiguration("repomixHelper").get("repomixCommand")||"repomix",t=o.include.join(","),a=o.ignore.join(","),c=[r];t&&c.push(`--include "${t}"`),a&&c.push(`--ignore "${a}"`);let l=c.join(" "),i=n.window.createOutputChannel("Repomix Helper");i.show(!0),i.appendLine("=== Repomix Export ==="),i.appendLine(l),i.appendLine(""),i.appendLine(`Include: ${o.include.length}, Ignore: ${o.ignore.length}`),i.appendLine("======================"),t?n.window.showInformationMessage("Repomix Helper: \u5DF2\u5BFC\u51FA\u547D\u4EE4\u5230 Output\uFF08Repomix Helper\uFF09\u3002"):n.window.showWarningMessage("Repomix Helper: include \u5217\u8868\u4E3A\u7A7A\uFF0C\u5BFC\u51FA\u7684\u547D\u4EE4\u53EF\u80FD\u65E0\u6CD5\u6253\u5305\u4F60\u671F\u671B\u7684\u5185\u5BB9\u3002")}async function j(e){d=n.window.createStatusBarItem(n.StatusBarAlignment.Left,100),d.command="repomixHelper.run",p=n.window.createStatusBarItem(n.StatusBarAlignment.Left,99),p.command="repomixHelper.clear",e.subscriptions.push(d,p),e.subscriptions.push(n.commands.registerCommand("repomixHelper.addInclude",(o,s)=>C(e,"include",o,s)),n.commands.registerCommand("repomixHelper.addIgnore",(o,s)=>C(e,"ignore",o,s)),n.commands.registerCommand("repomixHelper.run",()=>M(e)),n.commands.registerCommand("repomixHelper.clear",()=>U(e)),n.commands.registerCommand("repomixHelper.export",()=>P(e))),await w(e)}function O(){A?.dispose(),d?.dispose(),p?.dispose()}0&&(module.exports={activate,deactivate});
